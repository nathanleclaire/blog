
<!doctype html>
<!-- START OF _layouts/default.html -->
<html style="display:none;" lang="en">
	<head>
		<meta charset="utf-8">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" >
		<meta content="width=device-width,initial-scale=1" name="viewport">
		<meta content="I'm a solution delivery and technology expert.  I write about code (back-end and front-end), entrepreneurship, and life.  I'm obsessed with application performance, user experience, and shipping." name="description">
		<meta content="nathan leclaire" name="author">
		
		<title>Dragging and Dropping Images From One Browser Tab to Another In AngularJS &mdash; nathan leclaire | I care, I share, I'm Nathan LeClaire.</title>
		
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
		<link href="/stylesheets/main.css" rel="stylesheet">
		
		<script>
		   if(self == top) {
			   document.documentElement.style.display = 'block'; 
		   } else {
			   top.location = self.location; 
		   }
		</script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
		<script src="/js/jquery.modal.min.js"></script>
		<script src="/js/fuse.min.js"></script>
	</head>
	<body>
		<div class="wrap">
			<div id="sidebar">
				<header>
					<div class="title">
						<a href="http://nathanleclaire.com">
							<img src="/images/nateface.jpeg" class="nateface" /> 
							nathan leclaire 
						</a>
					</div>
					<p class="slogan">I care, I share, I'm Nathan LeClaire.</p>
					<div class="navi">
						<ul>
							<li><a href="/about/">About</a></li>
							<li><a href="/blog/archives">Archives</a></li>
							<li><a href="/atom.xml">RSS</a></li>
						</ul>
					</div> <!-- // .navi -->
					<div id="sidebar-email">
						<a href="mailto:nathan.leclaire@gmail.com">nathan.leclaire@gmail.com</a>
					</div>
				</header>
				<span id="shameless-self-promotion">
				<!-- Begin MailChimp Signup Form -->

				<div id="mc_embed_signup">
				<form action="https://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<label for="mce-EMAIL">Get my essays about tech delivered to your inbox</label>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
				</form>
				</div>
				<!--End mc_embed_signup-->
				
				<p>Quickly search the archive:</p>
				<input type="text" placeholder="Fuzzy search by keyword (e.g. Angular)" id="archive-search">
				<img src="/images/magnifying-glass.png" id="search-icon" />
				<ul id="archive-search-populate">
				</ul>
				
				</span>
			</div>
			<div id="content">
				<!-- START OF _layouts/post.html -->

<!-- START OF _includes/article.html -->
<article>
    <header>
        <h1>
            <a href="/blog/2014/01/11/dragging-and-dropping-images-from-one-browser-tab-to-another-in-angularjs/">Dragging and Dropping Images From One Browser Tab to Another In AngularJS</a>
        </h1>
        <h3 style="text-align: center;">by Nathan LeClaire</h3>
        <time>11 January 2014</time>
    </header>
    <div>
        <p><img src="/images/drag-drop-angular/demo.gif" title="Nice." ></p>

<p>So, I catch a lot of flak for not having a <a href="https://facebook.com">Facebook</a>.  I used to have one about six years ago, when <code>&lt;trolling&gt;</code> it was actually cool, our parents weren't on it, and we had no idea the NSA was watching our every little status update <code>&lt;/trolling&gt;</code>.  Then, for a variety of reasons, I deleted it.  Since then, people have complained endlessly about a dearth of Nate on social media, so I have started on a new website/project called The Natewerk, which is going to be the #1 social network for people who know me.</p>

<p>It's written using <a href="http://nodejs.org">Node.js</a> and <a href="http://angularjs.org">Angular.js</a>, and part of the functionality that I wanted was to have the ability for users to drag an image from a separate tab and drop it into the Natewerk tab, <a href="http://imgur.com">Imgur</a> style, taking an action appropriate for where the user was located in the app.  For instance, if they were on their profile page, I want the app to automatically upload that image to the server (perhaps with a prompt to confirm, also like Imgur), so they can easily add pictures of themselves to their profile.  If they were in the chatroom, it would show the image in the currently active conversation, so that people can post funny gifs/pictures and also easily post images for other people to see (this is one of the annoying things about Skype, in my opinion- you can drag and drop files but it won't display inline, the person you're chatting with has to download it).</p>

<p>Googling around found a few promising articles:</p>

<ul>
<li><a href="http://wisercoder.com/drag-drop-image-upload-directive-angular-js/">Drag and Drop File Upload with AngularJS</a> from <a href="http://onemightyroar.com/">One Mighty Roar</a></li>
<li><a href="http://buildinternet.com/2013/08/drag-and-drop-file-upload-with-angularjs/">Drag and drop image upload directive for Angular.js</a> from <a href="http://wisercoder.com">Wiser Coder</a></li>
</ul>


<p>But neither really gave me what I wanted, which was dragging and dropping from other tabs with the body-modal kind of effect that Imgur has.  So I set out to create my own.</p>

<h1>Creating a <code>&lt;char-flasher&gt;</code> directive</h1>

<iframe src="http://embed.plnkr.co/PmTUfAKXZQOc2dj01pcs/preview"></iframe>


<p>I wanted the ability to display some text on the screen with dots that blinked, as shown above, to display text such as <code>"Drop image to display in chat..."</code> to make the process a bit more responsive and encouraging.  This kind of directive would also be reusable for creating fancy flashing text in the future as well (for example, if we wanted to display a <code>" is typing..."</code> message in chat like many chat clients do).  I quickly cooked up a directive that can be used like so:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><pre><code>&lt;char-flasher display-text=&quot;Drop image here to display in chat...&quot; flash-char=&quot;.&quot; flash-interval=&quot;200&quot;&gt;&lt;/char-flasher&gt;</code></pre></figure></notextile></div>


<p>We pass in parameters here to have an eye towards reuse, although for now it is fairly geared towards the use case of a message with dots at the end (though you can use any character you want, not just <code>'.'</code>).  <code>display-text</code> is the message to display.  <code>flash-char</code> is the character to flash (it's assumed that this character is repeated at the end of the <code>display-text</code> string).  We pass these attributes as <code>'@'</code> parameters, so they will be interpreted literally.  We also set the directive to stop the <code>$interval</code> call we are using the animate the dots in case the directive is destroyed (this prevents memory leaks / wasted resources).</p>

<p>The code for the directive:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=js><code>app.directive('charFlasher', function($interval) {
  return {
    restrict: 'E',
    scope: {
      displayText: '@'
      flashChar: '@',
      flashInterval: '@'
    },
    template: '',
    link: function(scope, element, attrs) {
      var splitMessage = attrs.displayText.split(attrs.flashChar);
      var realContent = splitMessage.shift();
      var numFlashingChars = splitMessage.length;
      scope.flashingChars = attrs.flashChar;
      scope.realContent = realContent;
      var intervalId = $interval(function() {
        if (scope.flashingChars.length &gt;= numFlashingChars) {
          scope.flashingChars = '';
        } else {
          scope.flashingChars += attrs.flashChar;
        }
      }, attrs.flashInterval);
      element.on('$destroy', function() {
        $interval.cancel(intervalId);
      });
    }
  };
});</code></pre></figure></notextile></div>


<p>Not perfect, but pretty fun, and useful for our purposes.</p>

<h1>Creating the drag and drop directive</h1>

<p>So, when the user drags an image from another tab over our application, we want the screen to be blanketed with a semi-transparent dark overlay while our message displays, and then when they drop it we want to do something with that image's <code>src</code> attribute, like use it to upload the image to our server.</p>

<p>So we have to come up with a solution to this, and preferably do it in a manner that's idiomatic to Angular.  I ended up using jQuery in my final solution to make some things a bit easier, but I'm sure there are some craft souls out there who could do everything with just the jQuery lite implementation Angular ships with.</p>

<p>I came across <a href="http://css-tricks.com/snippets/jquery/append-site-overlay-div/">this blog post</a> by Chris Coyier that provided me information on how to create the "body-modal" effect.  It's pretty good, but it could be a bit more Angular-ey if we're going to use it in our app.  We'll start by creating a <code>&lt;div&gt;</code> right above the <code>&lt;/body&gt;</code> tag that will serve as our dark overlay, and we'll use <code>ng-show</code> to decide if it should be showing or not:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=js><code>&lt;div id=&quot;overlay&quot; ng-show=&quot;darkBody&quot;&gt;&lt;/div&gt;</code></pre></figure></notextile></div>


<p>Then we can add to our CSS file:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=css><code>#overlay {
    height: 100%;
    opacity: 0.6;
    position: absolute;
    top: 0;
    left: 0;
    background-color: black;
    width: 100%;
    z-index: 5000;
}</code></pre></figure></notextile></div>


<p>On our main controller we'll set some methods for manipulating this overlay:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=js><code>app.controller('MainCtrl', function($scope) {
    $scope.darkBody = false;

    $scope.darkenBody = function() {
        console.log('darkening body...');
        $scope.darkBody = true;
    };

    $scope.lightenBody = function() {
        $scope.darkBody = false;
    };
});</code></pre></figure></notextile></div>


<p>We'll declare this controller on our <code>&lt;html&gt;</code> tag, which is also where we declare our <code>ng-app</code> directive:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=js><code>&lt;html ng-app=&quot;nateWerk&quot; ng-controller=&quot;MainCtrl&quot;&gt;</code></pre></figure></notextile></div>


<p>Sweet.  Now we will create the create the <code>imageDragDropUpload</code> directive, which will be an attribute directive we place on <code>&lt;body&gt;</code>.  This is so the user can drag/drop the images anywhere on the page and everything will still work (note: the <code>&lt;body&gt;</code> <code>height</code> property must be set to 100% of the screen height for this all to work).</p>

<p>We define a function for darkening the body and bind it to the <code>dragenter</code> and <code>dragover</code> directives, so the first part of the link function for our directive looks like this:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=js><code>var darkenBody = function(event) {
    event.preventDefault();
    scope.$apply(function() {
        scope.darkenBody();
    });
};
elm.bind('dragenter', darkenBody);
elm.bind('dragover', darkenBody);</code></pre></figure></notextile></div>


<p>Our directive doesn't have an isolate scope, so we have access to the <code>darkenBody</code> method from <code>MainCtrl</code>'s scope (if you wanted multiple drag and drops into different areas of the page you should create one with isolate scope, but with this style there will only ever be one instance of the directive).</p>

<p>The <code>drop</code> binding is a little bit trickier, but not too bad.  We use jQuery to do a little bit of parsing of the content (HTML) that was handed to us, and get the <code>src</code> attribute to do with it what we will (in this case, add to an imageService so the controller can follow along).  Specifically, we use <code>event.dataTransfer.getData</code> to get the HTML that was dropped onto the page (see <a href="https://developer.mozilla.org/en-US/docs/DragDrop/Recommended_Drag_Types">this MDN documentation</a>), and create a new jQuery element out of it.  We filter this jQuery element for the <code>&lt;img&gt;</code> because sometimes multiple HTML elements are present in the dragged/dropped content.  Then we hide the body overlay:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=js><code>event.preventDefault();
var imageSrc = $(event.originalEvent.dataTransfer.getData('text/html')).filter(function(i, elm) { 
    return $(elm).is('img'); 
}).attr('src');
imageService.pushImage(imageSrc);  // Will append to list of images dropped into app
scope.lightenBody();</code></pre></figure></notextile></div>


<p>Pretty cool and useful in my opinion.  Hopefully your imagination is going crazy with possibilities in all sorts of directions right now, since this could be expanded to different types of content, including files from the user's computer and so on.  It'd benefit from a bit of animation and such as well.</p>

<p>I wasn't sure how Plunker/iframes would handle this, so I made a demo viewable <a href="http://nathanleclaire.github.io/angdragdropdemo">on Github</a>.</p>

<p>I'm hotlinking the images here, but please don't do this in production, it's rude (upload them to your own server instead).</p>

<h1>Conclusion</h1>

<p>This was a fun thing to learn how to do in AngularJS.  Since this uses HTML5 APIs, it won't work in older browsers, but I haven't thoroughly tested it to see where it will work and where it will not (seems to go over well in Chrome, Safari, and Firefox on a variety of OSes).  Ultimately it makes me excited for the future of Angular, the browser, and the NateWerk.</p>

<p>Until next time, stay sassy Internet.</p>

<ul>
<li>Nathan</li>
</ul>


    </div>
    <footer>
        <p>If you find a mistake or issue in this article, please <a id="pull-request-link" taget="_blank" href="">fix it and submit a pull request on Github</a> (must be signed in to your GitHub account).</p>
        <a target="_blank" style="display: block;" href="https://twitter.com/share?url=http://nathanleclaire.com/blog/2014/01/11/dragging-and-dropping-images-from-one-browser-tab-to-another-in-angularjs/&text=Great article from @upthecyberpunks : " class="social-media-spam">Tweet It</a>
        <a target="_blank" href="https://news.ycombinator.com/submitlink?u=http://nathanleclaire.com/blog/2014/01/11/dragging-and-dropping-images-from-one-browser-tab-to-another-in-angularjs/&t=" class="social-media-spam">Submit to Hacker News</a>
        <a target="_blank" style="display: block !important;" href="http://www.reddit.com/submit?url=http://nathanleclaire.com/blog/2014/01/11/dragging-and-dropping-images-from-one-browser-tab-to-another-in-angularjs/&title=" class="social-media-spam">Submit to Reddit</a>
        <br>


		



 

        <a target="_blank" style="display: block !important;" href="http://discourse.nathanleclaire.com">Chat in the forum!!</a>
    
        <div id="discourse-comments"></div>
    </footer>
    
</article>
<!-- END OF _includes/article.html -->


<!-- END OF _/layouts/post.html -->

			</div>
			<form class="modal" id="mailing-list-modal" action="http://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<h1>Like what you're reading?</h1>
					<img src="/images/happy-reader.jpeg"></img>
					<p style="display: block;" for="mce-EMAIL">Did you enjoy this article?  You might want to sign up for my mailing list.  I send out weekly-ish essays about hot new tech stuff.</p>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL-modal" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
			</form>
		</div> <!-- // .wrap -->
	<script type="text/javascript" src="/js/prettify.js"></script>
	<script>
	function supports_html5_storage() {
	  try {
		return 'localStorage' in window && window['localStorage'] !== null;
	  } catch (e) {
		return false;
	  }
	}

	$(document).ready(function () {
	    var fuse;

	    $("code").addClass("prettyprint");
	    prettyPrint();

	    $.getJSON("/articles.json", function(data) {
	    	// input:
	    	// [{title: "Learn Node.js The Troll Way", href: "blahblah"}, { ... }]
	    	fuse = new Fuse(data, {
	    	    keys: ['title', 'tags']
	    	});
	    });
	    
	    $("#archive-search").keyup(function() {
	    	var $this = $(this);
	    	var val = $this.val();
	    	var result = fuse.search(val).slice(0, 1);
	    	$list = $("#archive-search-populate");
	    	$list.empty();
	    	if (result.length > 0 && val !== '') {
	    	    $.each(result, function(i, e) {
	    	        $list.append('<li><a href="'+ e.href +'">'+ e.title +'</a></li>');
	    	    });
	    	}
	    });
	    
	    $(".social-media-spam").each(function () {
	        var e = $(this);
	        var t = e.attr("href");
	        var n = $("article header h1 a").html();
	        t += encodeURIComponent(n);
	        e.attr("href", t)
	    });

	    var e = window.location.href;
	    var t = $("#pull-request-link");
	    var n = "https://github.com/nathanleclaire/blog/edit/master/source/_posts/" + e.split("/").slice(4, 8).join("-") + ".markdown";
	    t.attr("href", n);

	    // Only offer mailing list once
		var tryModal = localStorage["modal"] ? false : true;

		// Don't offer mailing list to people on mobile
		if ($(window).width() < 720) {
			tryModal = false;
		}

		$('#mc-embedded-subscribe').click(function() {
			// Don't offer mailing list if people have
			// already clicked to try and sign up
			tryModal = false;
			localStorage["modal"] = "true";
		});

		$(window).scroll(function () {
			if (tryModal && document.URL.indexOf('archives') === -1 && document.URL.indexOf('about') === -1) {
				if (($(window).scrollTop() + $(window).height()) === $(document).height()) {
					if (supports_html5_storage()) {
						window.setTimeout(function() {
							$('#mailing-list-modal').modal({
								fadeDuration: 250
							});
							$('#mce-EMAIL-modal').focus();
							tryModal = false;
							localStorage["modal"] = "true";
						}, 1000);
					}
				}
			}
		});


	});
	</script>
	<script type="text/javascript">
	if ('/blog/2014/01/11/dragging-and-dropping-images-from-one-browser-tab-to-another-in-angularjs/' !== '/blog/index.html') {
	  var discourseUrl = "http://discourse.nathanleclaire.com/",
	      discourseEmbedUrl = 'http://nathanleclaire.com/blog/2014/01/11/dragging-and-dropping-images-from-one-browser-tab-to-another-in-angularjs/';

	  (function() {
	    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
	      d.src = discourseUrl + 'javascripts/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
	  })();
	}
	</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	  ga('create', 'UA-26758702-2', 'nathanleclaire.com');
	  ga('send', 'pageview');
	</script>
	</body>
</html>
<!-- END OF _layouts/default.html -->
