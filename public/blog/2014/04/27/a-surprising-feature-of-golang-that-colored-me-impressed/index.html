
<!doctype html>
<!-- START OF _layouts/default.html -->
<html style="display:none;" lang="en">
	<head>
		<meta charset="utf-8">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" >
		<meta content="width=device-width,initial-scale=1" name="viewport">
		<meta content="I'm a solution delivery and technology expert.  I write about code (back-end and front-end), entrepreneurship, and life.  I'm obsessed with application performance, user experience, and shipping." name="description">
		<meta content="nathan leclaire" name="author">
		
		<title>A Surprising Feature of Golang that Colored Me Impressed &mdash; nathan leclaire | I care, I share, I'm Nathan LeClaire.</title>
		
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
		<link href="/stylesheets/main.css" rel="stylesheet">
		
		<script>
		   if(self == top) {
			   document.documentElement.style.display = 'block'; 
		   } else {
			   top.location = self.location; 
		   }
		</script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
		<script src="/js/jquery.modal.min.js"></script>
		<script src="/js/fuse.min.js"></script>
	</head>
	<body>
		<div class="wrap">
			<div id="sidebar">
				<header>
					<div class="title">
						<a href="http://nathanleclaire.com">
							<img src="/images/nateface.jpeg" class="nateface" /> 
							nathan leclaire 
						</a>
					</div>
					<p class="slogan">I care, I share, I'm Nathan LeClaire.</p>
					<div class="navi">
						<ul>
							<li><a href="/about/">About</a></li>
							<li><a href="/blog/archives">Archives</a></li>
							<li><a href="/atom.xml">RSS</a></li>
						</ul>
					</div> <!-- // .navi -->
					<div id="sidebar-email">
						<a href="mailto:nathan.leclaire@gmail.com">nathan.leclaire@gmail.com</a>
					</div>
				</header>
				<span id="shameless-self-promotion">
				<!-- Begin MailChimp Signup Form -->

				<div id="mc_embed_signup">
				<form action="https://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<label for="mce-EMAIL">Get my essays about tech delivered to your inbox</label>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
				</form>
				</div>
				<!--End mc_embed_signup-->
				
				<p>Quickly search the archive:</p>
				<input type="text" placeholder="Fuzzy search by keyword (e.g. Angular)" id="archive-search">
				<img src="/images/magnifying-glass.png" id="search-icon" />
				<ul id="archive-search-populate">
				</ul>
				
				</span>
			</div>
			<div id="content">
				<!-- START OF _layouts/post.html -->

<!-- START OF _includes/article.html -->
<article>
    <header>
        <h1>
            <a href="/blog/2014/04/27/a-surprising-feature-of-golang-that-colored-me-impressed/">A Surprising Feature of Golang that Colored Me Impressed</a>
        </h1>
        <h3 style="text-align: center;">by Nathan LeClaire</h3>
        <time>27 April 2014</time>
    </header>
    <div>
        <p><em>EDIT:</em> Some commenters were confused about some things in this article, and I don't want people to get an unclear picture, so to clarify:</p>

<ol>
<li>Yes, I know that insertion into a hash table creates an arbitrary ordering of elements by definition.  For a variety of reasons, e.g. that not every map is a hash map as some posters have pointed out (and some languages have ordered hash maps), I can see how someone might hypothesize (especially with a na√Øve understanding of Go maps) that iteration order could be the same as insertion order.</li>
<li>My original example was contrived and does not demonstrate the point for most versions of Go (though I hear it might work for 1.3), so I have updated the code to be something you can chuck into an editor or the <a href="http://play.golang.org/p/ppIvkgAGL1">Go Playground</a> and see the effect for yourself.</li>
<li>It <em>is</em> true that Go runs from a <a href="https://codereview.appspot.com/5285042/patch/9001/10003">random offset for map iteration</a>.  It's not <em>just</em> arbitrary.</li>
</ol>


<p>Now back to your regularly scheduled article.  :)</p>

<p><img src="/images/gopher/hardhat.png"></p>

<h1>go blog.Article()</h1>

<p>The amount of enthusiasm and momentum I've been seeing regarding the <a href="http://golang.org">Go programming language</a> in the past few weeks has been really amazing.  Partially this is due to <a href="http://gophercon.com">Gophercon 2014</a>, which at the time of writing has just occured.  I am insanely jealous of the attendees - the format and talks sound like they were awesome, and it'd be great to bump elbows with titans such as <a href="https://twitter.com/rob_pike">Rob Pike</a> as well as hear all the cool stuff that everyone is building with Go.  I feel like additionally I've seen a big spike in blog articles related to Go lately, and many are making awesome pivots to include Go in their stack (for instance, <a href="https://www.digitalocean.com/company/blog/new-super-fast-droplet-console-thanks-golang/">Digital Ocean</a>, new cloud startup darling of the masses, just announced they reworked a bunch of Perl code to Go and improved some things such as response time dramatically).</p>

<p>I've never written the obligatory "ZOMG I played with Golang for two weeks and it's awesome" post, since I didn't really find it had much of a value add in its myriad forms.  But recently I came across a Go feature that I considered a very cool reflection of its very excellent (in my opinion) attitude as a language.</p>

<p>Go's <code>map</code> iteration order (using the <code>range</code> keyword) is random instead of in the order that the entries were added.  What does this mean (context), and why is it significant?</p>

<h1>Maps</h1>

<h2>Brief intro to maps</h2>

<p>Stolen directly from <a href="http://blog.golang.org/go-maps-in-action"><em>the</em> article on maps</a> by the prolific <a href="https://twitter.com/enneff">Andrew Gerrand</a>:</p>

<blockquote><p>One of the most useful data structures in computer science is the hash table. Many hash table implementations exist with varying properties, but in general they offer fast lookups, adds, and deletes. Go provides a built-in map type that implements a hash table.</p></blockquote>

<p>So in Go if you need a hash table you use a map.  Since Go is strongly typed you have to define what type the keys are, and what type the associated values are (e.g. strings, integers, pointers to structs, etc.).  A common use case, for instance, it to have a map where the keys are strings and the values they reference are strings.</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=go><code>m := make(map[string]string)</code></pre></figure></notextile></div>


<p>Usage is pretty straightforward.  Keys don't need to exist before they are assigned, or even before they are referenced (if they do not exist, we get the value type's "zero value").</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=go><code>m[&quot;bandName&quot;] = &quot;Funny Bones&quot;             // &quot;create&quot;
websiteTitle := m[&quot;bandName&quot;] + &quot; Music&quot;  // &quot;read&quot;
m[&quot;bandName&quot;] = &quot;Moon Taxi&quot;               // &quot;update&quot;
delete(m, &quot;bandName&quot;)                     // &quot;delete&quot;
fmt.Printf(m[&quot;bandName&quot;])                 // prints nothing since m[&quot;bandName&quot;] == &quot;&quot;</code></pre></figure></notextile></div>


<p>To iterate over all the entries in a map you use the <code>range</code> keyword:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=go><code>for key, value := range m {
    fmt.Println(&quot;Key:&quot;, key, &quot;Value:&quot;, value)
}</code></pre></figure></notextile></div>


<h2>Iteration Order</h2>

<p>At first glance a Go programmer might think that the output of this code:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=go><code>package main

import &quot;fmt&quot;

func main() {
    blogArticleViews := map[string]int{
        &quot;unix&quot;: 0,
        &quot;python&quot;: 1,
        &quot;go&quot;: 2,
        &quot;javascript&quot;: 3,
        &quot;testing&quot;: 4,
        &quot;philosophy&quot;: 5,
        &quot;startups&quot;: 6,
        &quot;productivity&quot;: 7,
        &quot;hn&quot;: 8,
        &quot;reddit&quot;: 9,
        &quot;C++&quot;: 10,
    }
    for key, views := range blogArticleViews {
        fmt.Println(&quot;There are&quot;, views, &quot;views for&quot;, key)
    }
}</code></pre></figure></notextile></div>


<p>Would be this:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=go><code>$ go run map_iteration_order.go
There are 0 views for unix
There are 1 views for python
There are 2 views for go
There are 3 views for javascript
There are 4 views for testing
There are 5 views for philosophy
There are 6 views for startups
There are 7 views for productivity
There are 8 views for hn
There are 9 views for reddit
There are 10 views for C++</code></pre></figure></notextile></div>


<p>But, since Go 1, the Go runtime actually randomizes the iteration order.  So in fact it will be more like this:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=go><code>$ go run map_iteration_order.go
There are 3 views for javascript
There are 5 views for philosophy
There are 10 views for C++
There are 0 views for unix
There are 1 views for python
There are 2 views for go
There are 4 views for testing
There are 6 views for startups
There are 7 views for productivity
There are 8 views for hn
There are 9 views for reddit</code></pre></figure></notextile></div>


<p>The Go language designers noticed that people were relying on the fact that keys were normally stored in the order they were added in, so they randomized the order in which the keys are iterated over.  Thus, if you want to output keys in the order they were added in, you need to keep track of which value is in which position in the order <em>yourself</em> like so :</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=go><code>import &quot;sort&quot;

var m map[int]string
var keys []int
for k := range m {
    keys = append(keys, k)
}
sort.Ints(keys)
for _, k := range keys {
    fmt.Println(&quot;Key:&quot;, k, &quot;Value:&quot;, m[k])
}</code></pre></figure></notextile></div>


<p>Note that the above codeblock is once again shamelessly stolen from <a href="http://blog.golang.org/go-maps-in-action">Andrew's excellent article</a>.</p>

<p>I think that peoples' reactions to these sort of things mostly can be categorized into two separate groups.</p>

<p>One group responds with anything from not understanding why this might be something that is done to being slightly peeved to vehemently disapproving.  These are most likely the ones who are comfortable making potentially dangerous or magical assumptions about what code is doing behind the scenes and they would prefer that the Go language designers allow them to continue to write dangerous code.</p>

<p>The other group accepts that this was an issue which was addressed, are thankful that the Go language designers are looking out for them, implements the provided solution and moves on.</p>

<h2>Why is it significant?</h2>

<p>In one word: attitude.</p>

<p>This seemingly innocuous language feature is something that I consider to be a very good sign in terms of general language philosophy.  Instead of trying to be overly flexible and allow sloppy programming, Go forces you to get things straight from the get-go.  I think that this is one of the things that contributes to the reported "fuzzy good feeling" that Go programmers reference suggesting that if their program compiles (and especially if it conforms to Go idioms as outlined above), there is a good chance it will work as intended as well.  No sneaky typing bugs, missed semi-colons and so on.</p>

<p>In particular Andrew's referenced article mentions that this was something the Go language designers <em>changed</em> rather than continuing to allow people to rely on broken assumptions.  One of my hugest pet peeves is when broken or buggy functionality (this could happen in a deliverable, or in a programming language, or elsewhere) becomes a feature through acceptance and workarounds and then a huge stink is raised when the "feature" is attempted to be fixed!  It's pretty clear that, say, PHP and JavaScript have let their culture wander in these directions for various reasons (they're working on it, but there's a huge crushing amount of debt to be paid, and some things that will never get fixed).</p>

<p>One of the biggest weak points of PHP, for instance, is the needle-versus-haystack problem.  My ideal language (Blub?) would have the sort of attitude that gets driven absolutely crazy by this sort of inconsistency.  This is also why I find the Go language designer's refusal to cave to the cow-towing for exceptions and generics reassuring - they want very badly to <em>do the right thing</em> and they know it takes time.  They're in no rush and it's a lot easier to add features than to un-add them.</p>

<h1>Conclude</h1>

<p>Go is a pleasant language and just so well thought-out in many ways.  Don't be too quick to judge or criticize because it lacks features you are accustomed to such as generics or dynamic typing- perhaps if you give it a try you will find that you do not miss them all that much and you are writing simple, clean, elegant code with easy-to-integrate concurrency.</p>

<p>Go is definitely still growing and evolving, and that's part of the fun of it as well.  It is definitely proving to be no less than rock-solid and production-ready, yet still performance and reliability keeps improving.  Just check out the awesome numbers on these benchmarks <a href="https://groups.google.com/forum/#!msg/golang-dev/2YRmu_AWz68/tKAZgpV7zQwJ">Rob Pike recently posted</a> comparing the Go 1 release to tip (nearing 1.3):</p>

<pre style="transition: 1s ease-in-out all;" id="bench">
Delta from go1 to tip: 

benchmark                          old ns/op      new ns/op      delta 
BenchmarkBinaryTree17              7102124000     5790215308     <span style="color: #32cd32">-18.47%</span> 
BenchmarkFannkuch11                7139655000     4361664854     <span style="color: #32cd32">-38.91%</span> 
BenchmarkFmtFprintfEmpty           177            104            <span style="color: #32cd32">-41.24%</span> 
BenchmarkFmtFprintfString          575            312            <span style="color: #32cd32">-45.74%</span> 
BenchmarkFmtFprintfInt             424            230            <span style="color: #32cd32">-45.75%</span> 
BenchmarkFmtFprintfIntInt          682            403            <span style="color: #32cd32">-40.91%</span> 
BenchmarkFmtFprintfPrefixedInt     661            394            <span style="color: #32cd32">-40.39%</span> 
BenchmarkFmtFprintfFloat           907            598            <span style="color: #32cd32">-34.07%</span> 
BenchmarkFmtManyArgs               2787           1663           <span style="color: #32cd32">-40.33%</span> 
BenchmarkGobDecode                 31284200       10693446       <span style="color: #32cd32">-65.82%</span> 
BenchmarkGobEncode                 13900550       6919498        <span style="color: #32cd32">-50.22%</span> 
BenchmarkGzip                      636714400      704154254      <span style="color: red">+10.59%</span> 
BenchmarkGunzip                    275620600      139906588      <span style="color: #32cd32">-49.24%</span> 
BenchmarkHTTPClientServer          144041         71739          <span style="color: #32cd32">-50.20%</span> 
BenchmarkJSONEncode                83472200       32969241       <span style="color: #32cd32">-60.50%</span> 
BenchmarkJSONDecode                391968600      120858167      <span style="color: #32cd32">-69.17%</span> 
BenchmarkMandelbrot200             9540360        6062905        <span style="color: #32cd32">-36.45%</span> 
BenchmarkGoParse                   10007700       6760226        <span style="color: #32cd32">-32.45%</span> 
BenchmarkRegexpMatchEasy0_32       198            168            <span style="color: #32cd32">-15.15%</span> 
BenchmarkRegexpMatchEasy0_1K       540            479            <span style="color: #32cd32">-11.30%</span> 
BenchmarkRegexpMatchEasy1_32       175            149            <span style="color: #32cd32">-14.86%</span> 
BenchmarkRegexpMatchEasy1_1K       1353           1414           <span style="color: red">+4.51%</span>
BenchmarkRegexpMatchMedium_32      311            307            <span style="color: #32cd32">-1.29%</span> 
BenchmarkRegexpMatchMedium_1K      108924         126452         <span style="color: red">+16.09%</span>
BenchmarkRegexpMatchHard_32        4972           5681           <span style="color: red">+14.26%</span>
BenchmarkRegexpMatchHard_1K        157354         181042         <span style="color: red">+15.05%</span>
BenchmarkRevcomp                   1362067000     1162752845     <span style="color: #32cd32">-14.63%</span> 
BenchmarkTemplate                  714330000      144396424      <span style="color: #32cd32">-79.79%</span> 
BenchmarkTimeParse                 1651           669            <span style="color: #32cd32">-59.48%</span> 
BenchmarkTimeFormat                3215           714            <span style="color: #32cd32">-77.79%</span> 
</pre>


<p><button id="relBench" type="button">Click me to show relative benchmarks above!!</button></p>

<p>I love this!  And I love Go.</p>

<p>Until next time, stay sassy Internet.  And <a href="http://nathanleclaire.com">consider subscribing to my mailing list</a>.</p>

<ul>
<li>Nathan</li>
</ul>


<script>
$(document).ready(function () {
    $('#relBench').click(function () {
        $("#bench").css('line-height', '50px');
        $('pre > span').each(function(i, e) { 
            var $e = $(e); 
            $e.css('transition', '1s ease-in-out all');
            $e.css('font-size', $e.html().slice(1, $e.html().length-1) + 'px'); 
        }); 
    });
});
</script>


    </div>
    <footer>
        <p>If you find a mistake or issue in this article, please <a id="pull-request-link" taget="_blank" href="">fix it and submit a pull request on Github</a> (must be signed in to your GitHub account).</p>
        <a target="_blank" style="display: block;" href="https://twitter.com/share?url=http://nathanleclaire.com/blog/2014/04/27/a-surprising-feature-of-golang-that-colored-me-impressed/&text=Great article from @upthecyberpunks : " class="social-media-spam">Tweet It</a>
        <a target="_blank" href="https://news.ycombinator.com/submitlink?u=http://nathanleclaire.com/blog/2014/04/27/a-surprising-feature-of-golang-that-colored-me-impressed/&t=" class="social-media-spam">Submit to Hacker News</a>
        <a target="_blank" style="display: block !important;" href="http://www.reddit.com/submit?url=http://nathanleclaire.com/blog/2014/04/27/a-surprising-feature-of-golang-that-colored-me-impressed/&title=" class="social-media-spam">Submit to Reddit</a>
        <br>


		



  
		
			Tagged under
		
    <a class='category' href='/blog/categories/golang/'>golang</a>
	

 

        <a target="_blank" style="display: block !important;" href="http://discourse.nathanleclaire.com">Chat in the forum!!</a>
    
        <div id="discourse-comments"></div>
    </footer>
    
</article>
<!-- END OF _includes/article.html -->


<!-- END OF _/layouts/post.html -->

			</div>
			<form class="modal" id="mailing-list-modal" action="http://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<h1>Like what you're reading?</h1>
					<img src="/images/happy-reader.jpeg"></img>
					<p style="display: block;" for="mce-EMAIL">Did you enjoy this article?  You might want to sign up for my mailing list.  I send out weekly-ish essays about hot new tech stuff.</p>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL-modal" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
			</form>
		</div> <!-- // .wrap -->
	<script type="text/javascript" src="/js/prettify.js"></script>
	<script>
	function supports_html5_storage() {
	  try {
		return 'localStorage' in window && window['localStorage'] !== null;
	  } catch (e) {
		return false;
	  }
	}

	$(document).ready(function () {
	    var fuse;

	    $("code").addClass("prettyprint");
	    prettyPrint();

	    $.getJSON("/articles.json", function(data) {
	    	// input:
	    	// [{title: "Learn Node.js The Troll Way", href: "blahblah"}, { ... }]
	    	fuse = new Fuse(data, {
	    	    keys: ['title', 'tags']
	    	});
	    });
	    
	    $("#archive-search").keyup(function() {
	    	var $this = $(this);
	    	var val = $this.val();
	    	var result = fuse.search(val).slice(0, 1);
	    	$list = $("#archive-search-populate");
	    	$list.empty();
	    	if (result.length > 0 && val !== '') {
	    	    $.each(result, function(i, e) {
	    	        $list.append('<li><a href="'+ e.href +'">'+ e.title +'</a></li>');
	    	    });
	    	}
	    });
	    
	    $(".social-media-spam").each(function () {
	        var e = $(this);
	        var t = e.attr("href");
	        var n = $("article header h1 a").html();
	        t += encodeURIComponent(n);
	        e.attr("href", t)
	    });

	    var e = window.location.href;
	    var t = $("#pull-request-link");
	    var n = "https://github.com/nathanleclaire/blog/edit/master/source/_posts/" + e.split("/").slice(4, 8).join("-") + ".markdown";
	    t.attr("href", n);

	    // Only offer mailing list once
		var tryModal = localStorage["modal"] ? false : true;

		// Don't offer mailing list to people on mobile
		if ($(window).width() < 720) {
			tryModal = false;
		}

		$('#mc-embedded-subscribe').click(function() {
			// Don't offer mailing list if people have
			// already clicked to try and sign up
			tryModal = false;
			localStorage["modal"] = "true";
		});

		$(window).scroll(function () {
			if (tryModal && document.URL.indexOf('archives') === -1 && document.URL.indexOf('about') === -1) {
				if (($(window).scrollTop() + $(window).height()) === $(document).height()) {
					if (supports_html5_storage()) {
						window.setTimeout(function() {
							$('#mailing-list-modal').modal({
								fadeDuration: 250
							});
							$('#mce-EMAIL-modal').focus();
							tryModal = false;
							localStorage["modal"] = "true";
						}, 1000);
					}
				}
			}
		});


	});
	</script>
	<script type="text/javascript">
	if ('/blog/2014/04/27/a-surprising-feature-of-golang-that-colored-me-impressed/' !== '/blog/index.html') {
	  var discourseUrl = "http://discourse.nathanleclaire.com/",
	      discourseEmbedUrl = 'http://nathanleclaire.com/blog/2014/04/27/a-surprising-feature-of-golang-that-colored-me-impressed/';

	  (function() {
	    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
	      d.src = discourseUrl + 'javascripts/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
	  })();
	}
	</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	  ga('create', 'UA-26758702-2', 'nathanleclaire.com');
	  ga('send', 'pageview');
	</script>
	</body>
</html>
<!-- END OF _layouts/default.html -->
