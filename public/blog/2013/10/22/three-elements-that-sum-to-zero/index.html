
<!doctype html>
<!-- START OF _layouts/default.html -->
<html style="display:none;" lang="en">
	<head>
		<meta charset="utf-8">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" >
		<meta content="width=device-width,initial-scale=1" name="viewport">
		<meta content="I'm a solution delivery and technology expert.  I write about code (back-end and front-end), entrepreneurship, and life.  I'm obsessed with application performance, user experience, and shipping." name="description">
		<meta content="nathan leclaire" name="author">
		
		<title>Three Elements That Sum To Zero &mdash; nathan leclaire | I care, I share, I'm Nathan LeClaire.</title>
		
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
		<link href="/stylesheets/main.css" rel="stylesheet">
		
		<script>
		   if(self == top) {
			   document.documentElement.style.display = 'block'; 
		   } else {
			   top.location = self.location; 
		   }
		</script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
		<script src="/js/jquery.modal.min.js"></script>
		<script src="/js/fuse.min.js"></script>
	</head>
	<body>
		<div class="wrap">
			<div id="sidebar">
				<header>
					<div class="title">
						<a href="http://nathanleclaire.com">
							<img src="/images/nateface.jpeg" class="nateface" /> 
							nathan leclaire 
						</a>
					</div>
					<p class="slogan">I care, I share, I'm Nathan LeClaire.</p>
					<div class="navi">
						<ul>
							<li><a href="/about/">About</a></li>
							<li><a href="/blog/archives">Archives</a></li>
							<li><a href="/atom.xml">RSS</a></li>
						</ul>
					</div> <!-- // .navi -->
					<div id="sidebar-email">
						<a href="mailto:nathan.leclaire@gmail.com">nathan.leclaire@gmail.com</a>
					</div>
				</header>
				<span id="shameless-self-promotion">
				<!-- Begin MailChimp Signup Form -->

				<div id="mc_embed_signup">
				<form action="https://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<label for="mce-EMAIL">Get my essays about tech delivered to your inbox</label>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
				</form>
				</div>
				<!--End mc_embed_signup-->
				
				<p>Quickly search the archive:</p>
				<input type="text" placeholder="Fuzzy search by keyword (e.g. Angular)" id="archive-search">
				<img src="/images/magnifying-glass.png" id="search-icon" />
				<ul id="archive-search-populate">
				</ul>
				
				</span>
			</div>
			<div id="content">
				<!-- START OF _layouts/post.html -->

<!-- START OF _includes/article.html -->
<article>
    <header>
        <h1>
            <a href="/blog/2013/10/22/three-elements-that-sum-to-zero/">Three Elements That Sum To Zero</a>
        </h1>
        <h3 style="text-align: center;">by Nathan LeClaire</h3>
        <time>22 October 2013</time>
    </header>
    <div>
        <p>There's an interview question (for developers) that recently I've been asking (if they have already proven they can <a href="http://www.codinghorror.com/blog/2007/02/why-cant-programmers-program.html">FizzBuzz</a>) which goes a little something like this:</p>

<blockquote>Given a collection of integers, return the indices of any three elements which sum to zero.  For instance, if you are given <code>{-1, 6, 8, 9, 10, -100, 78, 0, 1}</code>, you could return <code>{0, 7, 8}</code> because <code>-1 + 1 + 0 == 0</code>.  You can't use the same index twice, and if there is no match you should return <code>{-1, -1, -1}</code>.</blockquote>


<p>I first heard this question in an interview with a San Francisco-based startup, and it has since become sort of a workhorse interview question around the office.  As it turns out, this question has the potential to <a href="http://xkcd.com/356/">nerd snipe</a> developers pretty effectively.  I know, because I coded up the naive solution first before deciding that it wasn't good enough, and that I wanted to write it a faster way.  Combining this with my recent revival of interest in C++ (I learned it long ago but have been mostly working with scripting languages lately) proved to be an interesting experience.  This is the story of one man (me), and his quest to write code to efficiently solve this problem.  In my solutions I use the <code>std::vector</code> class, as I also used this as an opportunity to refresh some STL knowledge, but in the article I use the words "array" and "vector" interchangably (these solutions could also be implemented with arrays, there is nothing special about using vectors in this case).</p>

<h1>Solving Things Naively</h1>

<p>The obvious way to do this is with brute force.  Starting with the zeroeth, first, and second elements of the collection, compare every possible combination of three elements to see if they sum to zero.  Sample code (<code>using namespace std;</code> is implied):</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>vector&lt;int&gt; three_indices_that_sum_to_zero_naive(vector&lt;int&gt; v)
{
    // O(n ** 3) time complexity in average case
    int i, j, k, n;
    n = v.size();
    for(i = 0; i &lt; n-2; i++)
    {
        for(j = i+1; j &lt; n-1; j++)
        {
            for(k = j+1; k &lt; n; k++)
            {
                if ((v.at(i) + v.at(j) + v.at(k)) == 0)
                {
                    return three_vec(i, j, k);
                }
            }
        }   
    }
    return three_vec(-1, -1, -1); 
}</code></pre></figure></notextile></div>


<p><code>three_vec</code> is a utility method that I use to return a vector of three integers:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>vector&lt;int&gt; three_vec(int i, int j, int k)
{
    int arr[] = {i, j, k};
    vector&lt;int&gt; indices (arr, arr + sizeof(arr) / sizeof(arr[0]));
    return indices;
}</code></pre></figure></notextile></div>


<p>This is the obvious way to do the problem at first glance, and it has the advantage of simplicity and readability (a competent developer looking at the code should be able to figure it out fairly quickly).  However, as noted in the comments for the function defined, it runs with a time complexity of O(<em>n<sup>3</sup></em>).  Can we do better?</p>

<h1>Solving Things Suavely</h1>

<p>Of course we can, or else I wouldn't be writing this article!  Reaching into our algorithmic bag of tricks, we begin to ask ourselves: Is there anything we can do to this otherwise unordered vector of integers that would make it easier for us to get what we're after?</p>

<p><em>"Hm,"</em> you say to yourself.  <em>"We could trying sorting it.  This will run in O(n log n) time but it will allow us to find what we are looking for much more quickly."</em>   But wait- sorting the vector will change the place of the elements, and consequently their index, which is what we are after.  Therefore, we must rely on an additional (simple) data structure if we are going to take this approach:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>typedef struct index_value_pair {
    int index;
    int value;
} index_value_pair;</code></pre></figure></notextile></div>


<p>Now we can make a new array and sort that based on <code>index_value_pair</code>'s <code>value</code> element:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>/* Utility Function to create an index_value_pair */
index_value_pair make_index_value_pair(int index, int value)
{
    index_value_pair ivp;
    ivp.index = index;
    ivp.value = value;
    return ivp;
}

vector&lt;int&gt; three_indices_that_sum_to_zero_suave(vector&lt;int&gt; v)
{
    int i, j, k, n, sum;
    n = v.size();
    vector&lt;index_value_pair&gt; value_index_vec;
    for (i = 0; i &lt; n; i++) 
    {
        value_index_vec.push_back(make_index_value_pair(i, v.at(i)));
    }
    sort(value_index_vec.begin(), value_index_vec.end(), suave_comp);</code></pre></figure></notextile></div>


<p>Then, we can work our way forwards from the beginning of the array starting with the zeroeth and first elements (let's call them the <code>i</code>th and <code>j</code>th), and <em>backwards</em> from the end of the array with the third (the <code>k</code>th).  <code>i</code> will go to <code>n-2</code> and start off an inner loop where <code>j = i + 1</code>.  In the inner loop, if the sum of the elements is positive, we decrement <code>k</code> because we need a smaller sum (closer to zero).  If the sum of the elements is negative, we increment <code>j</code> because we need a larger sum (also closer to zero).  If the elements sum to zero, great!  We have our match.  If <code>j</code> and <code>k</code> meet, we go on to the next loop.  This process shaves a whole multiple of <code>n</code> comparisons off our algorithm's runtime and allows us to do things in O(<em>n<sup>2</sup></em>) time.</p>

<p>You can intuitively grasp why this is faster by asking yourself how many comparisons it would take to find the elements that sum to zero with this array (sorted) and this algorithm:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>{-10, -8, -6, 0, 3, 5, 18}</code></pre></figure></notextile></div>


<p>versus this one (same elements, different order) with brute force:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>{-6, -8, 0, 3, 10, -8, 18}</code></pre></figure></notextile></div>


<p>Therefore the whole function looks like this and runs with O(<em>n log n + n<sup>2</sup></em>) time complexity including the sort.  O(<em>n <sup>2</sup></em>) is asymptotically larger than O(<em>n log n</em>), so this time complexity resolves to O(<em>n <sup>2</sup></em>) (<em>editor's note</em>: thanks to Reddit user Olathe for pointing this out).  This should outperform the O(<em>n<sup>3</sup></em>) algorithm in most cases:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>vector&lt;int&gt; three_indices_that_sum_to_zero_suave(vector&lt;int&gt; v)
{
    int i, j, k, n, sum;
    n = v.size();
    vector&lt;index_value_pair&gt; value_index_vec;
    for (i = 0; i &lt; n; i++) 
    {
        value_index_vec.push_back(make_index_value_pair(i, v.at(i)));
    }
    // print_value_index_vec(value_index_vec);
    sort(value_index_vec.begin(), value_index_vec.end(), suave_comp);
    for (i = 0; i &lt; n-2; i++)
    {
        j = i+1;
        k = n-1;
        while (k &gt; j)
        {
            sum = sum_from_value_index_vec(value_index_vec, i, j, k);
            if (sum == 0)
            {
                return three_vec(value_index_vec.at(i).index, value_index_vec.at(j).index, value_index_vec.at(k).index);   
            }

            if (sum &gt; 0)
            {
                k--;
            }
            else
            {
                j++;
            }

        }
    }
    return three_vec(-1, -1, -1);
}</code></pre></figure></notextile></div>


<p>Interestingly, with the first few benchmarks I ran, the naive version was outperforming the efficient version, and I couldn't quite figure out why (the first command line argument indicates how many random elements to generate in our test array- in other words, <code>N</code>).</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>$ ./indices_sum_to_zero 100000
Initializing...

Using naive...
Performance: 0 ticks
Naive : {0, 1, 77}
Using suave...
The elements: -100 0 100
Performance: 10000 ticks
Suave : {73045, 48974, 3270}</code></pre></figure></notextile></div>


<p>How could this be?  My carefully crafted algorithm was getting stomped by an algorithm I knew to be inferior.  After generating and poking around at a few callgrind files attempting to track down the issue, I suddenly realized that it was right in front of my eyes, in two constant definitions I had made and forgotten about early on:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>static int LOWERBOUND = -100;
static int UPPERBOUND = 100;</code></pre></figure></notextile></div>


<p></p>

<p>These settings were used to specify the range of the pseudorandom integers I was using to test the algorithms with, and when they were so close together the naive algorithm was outperforming the "suave" one because the additional overhead of sorting was so costly.</p>

<p>What if we change the bounds to be <code>{-10000000, 10000000}</code>?</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><pre class=c++><code>$ ./indices_sum_to_zero 100000
Initializing...

Using naive...
Performance: 70000 ticks
Naive : {0, 539, 31774}
Using suave...
Performance: 10000 ticks
Suave : {78891, 33850, 54525}</code></pre></figure></notextile></div>


<p>Much closer to what we expect!  For smaller values of N, and upper/lower bounds that are closer together, the naive version seems to perform better.  As the range and value of N gets larger, the "suave" algorithm begins to get more appealing.  I'd be curious to see a more rigorous numerical analysis of why this is.</p>

<p>Check out the <a href="https://github.com/nathanleclaire/algorithms_and_data_structures/blob/master/indices_sum_to_zero/indices_sum_to_zero.cc">code on github</a> if you're so inclined.  Cheers, and I'll see you next week!</p>

<p><em>EDIT</em> : Based on some feedback from Reddit I have revised a few things, notably:</p>

<ul>
<li>There was a bug in the implementation of <code>three_vec</code> that caused the returned value to be the same for suave and naive versions (fixed in <a href="https://github.com/nathanleclaire/algorithms_and_data_structures/commit/794993e01b1e0fa6154c722c4d74009b02cdef45">794993e01b1e0fa6154c722c4d74009b02cdef45</a> )</li>
<li>Constant definition is now done with <code>static const</code> instead of <code>#define</code> statements</li>
</ul>


    </div>
    <footer>
        <p>If you find a mistake or issue in this article, please <a id="pull-request-link" taget="_blank" href="">fix it and submit a pull request on Github</a> (must be signed in to your GitHub account).</p>
        <a target="_blank" style="display: block;" href="https://twitter.com/share?url=http://nathanleclaire.com/blog/2013/10/22/three-elements-that-sum-to-zero/&text=Great article from @upthecyberpunks : " class="social-media-spam">Tweet It</a>
        <a target="_blank" href="https://news.ycombinator.com/submitlink?u=http://nathanleclaire.com/blog/2013/10/22/three-elements-that-sum-to-zero/&t=" class="social-media-spam">Submit to Hacker News</a>
        <a target="_blank" style="display: block !important;" href="http://www.reddit.com/submit?url=http://nathanleclaire.com/blog/2013/10/22/three-elements-that-sum-to-zero/&title=" class="social-media-spam">Submit to Reddit</a>
        <br>


		



  
		
			Tagged under
		
    <a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/computer-science/'>computer science</a>, <a class='category' href='/blog/categories/math/'>math</a>, <a class='category' href='/blog/categories/programming/'>programming</a>, <a class='category' href='/blog/categories/stl/'>stl</a>
	

 

        <a target="_blank" style="display: block !important;" href="http://discourse.nathanleclaire.com">Chat in the forum!!</a>
    
        <div id="discourse-comments"></div>
    </footer>
    
</article>
<!-- END OF _includes/article.html -->


<!-- END OF _/layouts/post.html -->

			</div>
			<form class="modal" id="mailing-list-modal" action="http://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<h1>Like what you're reading?</h1>
					<img src="/images/happy-reader.jpeg"></img>
					<p style="display: block;" for="mce-EMAIL">Did you enjoy this article?  You might want to sign up for my mailing list.  I send out weekly-ish essays about hot new tech stuff.</p>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL-modal" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
			</form>
		</div> <!-- // .wrap -->
	<script type="text/javascript" src="/js/prettify.js"></script>
	<script>
	function supports_html5_storage() {
	  try {
		return 'localStorage' in window && window['localStorage'] !== null;
	  } catch (e) {
		return false;
	  }
	}

	$(document).ready(function () {
	    var fuse;

	    $("code").addClass("prettyprint");
	    prettyPrint();

	    $.getJSON("/articles.json", function(data) {
	    	// input:
	    	// [{title: "Learn Node.js The Troll Way", href: "blahblah"}, { ... }]
	    	fuse = new Fuse(data, {
	    	    keys: ['title', 'tags']
	    	});
	    });
	    
	    $("#archive-search").keyup(function() {
	    	var $this = $(this);
	    	var val = $this.val();
	    	var result = fuse.search(val).slice(0, 1);
	    	$list = $("#archive-search-populate");
	    	$list.empty();
	    	if (result.length > 0 && val !== '') {
	    	    $.each(result, function(i, e) {
	    	        $list.append('<li><a href="'+ e.href +'">'+ e.title +'</a></li>');
	    	    });
	    	}
	    });
	    
	    $(".social-media-spam").each(function () {
	        var e = $(this);
	        var t = e.attr("href");
	        var n = $("article header h1 a").html();
	        t += encodeURIComponent(n);
	        e.attr("href", t)
	    });

	    var e = window.location.href;
	    var t = $("#pull-request-link");
	    var n = "https://github.com/nathanleclaire/blog/edit/master/source/_posts/" + e.split("/").slice(4, 8).join("-") + ".markdown";
	    t.attr("href", n);

	    // Only offer mailing list once
		var tryModal = localStorage["modal"] ? false : true;

		// Don't offer mailing list to people on mobile
		if ($(window).width() < 720) {
			tryModal = false;
		}

		$('#mc-embedded-subscribe').click(function() {
			// Don't offer mailing list if people have
			// already clicked to try and sign up
			tryModal = false;
			localStorage["modal"] = "true";
		});

		$(window).scroll(function () {
			if (tryModal && document.URL.indexOf('archives') === -1 && document.URL.indexOf('about') === -1) {
				if (($(window).scrollTop() + $(window).height()) === $(document).height()) {
					if (supports_html5_storage()) {
						window.setTimeout(function() {
							$('#mailing-list-modal').modal({
								fadeDuration: 250
							});
							$('#mce-EMAIL-modal').focus();
							tryModal = false;
							localStorage["modal"] = "true";
						}, 1000);
					}
				}
			}
		});


	});
	</script>
	<script type="text/javascript">
	if ('/blog/2013/10/22/three-elements-that-sum-to-zero/' !== '/blog/index.html') {
	  var discourseUrl = "http://discourse.nathanleclaire.com/",
	      discourseEmbedUrl = 'http://nathanleclaire.com/blog/2013/10/22/three-elements-that-sum-to-zero/';

	  (function() {
	    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
	      d.src = discourseUrl + 'javascripts/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
	  })();
	}
	</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	  ga('create', 'UA-26758702-2', 'nathanleclaire.com');
	  ga('send', 'pageview');
	</script>
	</body>
</html>
<!-- END OF _layouts/default.html -->
