
<!doctype html>
<!-- START OF _layouts/default.html -->
<html style="display:none;" lang="en">
	<head>
		<meta charset="utf-8">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" >
		<meta content="width=device-width,initial-scale=1" name="viewport">
		<meta content="I'm a solution delivery and technology expert.  I write about code (back-end and front-end), entrepreneurship, and life.  I'm obsessed with application performance, user experience, and shipping." name="description">
		<meta content="nathan leclaire" name="author">
		
		<title>Sending Email From Gmail Using Golang &mdash; nathan leclaire | I care, I share, I'm Nathan LeClaire.</title>
		
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
		<link href="/stylesheets/main.css" rel="stylesheet">
		
		<script>
		   if(self == top) {
			   document.documentElement.style.display = 'block'; 
		   } else {
			   top.location = self.location; 
		   }
		</script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
		<script src="/js/jquery.modal.min.js"></script>
		<script src="/js/fuse.min.js"></script>
	</head>
	<body>
		<div class="wrap">
			<div id="sidebar">
				<header>
					<div class="title">
						<a href="http://nathanleclaire.com">
							<img src="/images/nateface.jpeg" class="nateface" /> 
							nathan leclaire 
						</a>
					</div>
					<p class="slogan">I care, I share, I'm Nathan LeClaire.</p>
					<div class="navi">
						<ul>
							<li><a href="/about/">About</a></li>
							<li><a href="/blog/archives">Archives</a></li>
							<li><a href="/atom.xml">RSS</a></li>
						</ul>
					</div> <!-- // .navi -->
					<div id="sidebar-email">
						<a href="mailto:nathan.leclaire@gmail.com">nathan.leclaire@gmail.com</a>
					</div>
				</header>
				<span id="shameless-self-promotion">
				<!-- Begin MailChimp Signup Form -->

				<div id="mc_embed_signup">
				<form action="https://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<label for="mce-EMAIL">Get my essays about tech delivered to your inbox</label>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
				</form>
				</div>
				<!--End mc_embed_signup-->
				
				<p>Quickly search the archive:</p>
				<input type="text" placeholder="Fuzzy search by keyword (e.g. Angular)" id="archive-search">
				<img src="/images/magnifying-glass.png" id="search-icon" />
				<ul id="archive-search-populate">
				</ul>
				
				</span>
			</div>
			<div id="content">
				<!-- START OF _layouts/post.html -->

<!-- START OF _includes/article.html -->
<article>
    <header>
        <h1>
            <a href="/blog/2013/12/17/sending-email-from-gmail-using-golang/">Sending Email From Gmail Using Golang</a>
        </h1>
        <h3 style="text-align: center;">by Nathan LeClaire</h3>
        <time>17 December 2013</time>
    </header>
    <div>
        <p>As part of the soon-to-be-deployed <a href="http://github.com/nathanleclaire/checkforbrokenlinks">checkforbrokenlinks</a> app, I found myself faced with the task of creating a contact form that would allow users to send me feedback on the app, so I could improve it and make it better in the future.  In order to do so I had to figure out a way to configure my server-side backend, written in Golang, to perform all of the neccessary steps in order to send me an e-mail from the front-end (written in <a href="http://angularjs.org">AngularJS</a>).  Looking into it, I don't see too many e-mail sending implementations in Golang available easily online, so I'm putting the results of my research out there for all to see.</p>

<p><img src="/images/golang-gmail/gopher_mail.jpeg" title="A helpful little gopher." ></p>

<h1><code>net/smtp</code></h1>

<p>Golang provides a <code>smtp</code> (<a href="http://golang.org/pkg/net/smtp/">Simple Mail Transfer Protocol</a>) library as part of its <code>net</code> package.  <code>"net/smtp"</code> exposes some useful functionality right out of the box.  As it turns out, it's <a href="">not too hard</a> to connect to <a href="">Gmail</a> using <code>net/smtp</code>, which saved me some serious misgivings I was having about setting up and configuring my own mail server (I've no doubt it could be done, but I was looking for a quick and simple solution).  So I signed up for a <a href="https://accounts.google.com/SignUp?service=mail&amp;hl=en_us&amp;continue=http%3A%2F%2Fmail.google.com%2Fmail%2F%3Fpc%3Den-ha-na-us-bk&amp;utm_campaign=en&amp;utm_source=en-ha-na-us-bk&amp;utm_medium=ha">new Gmail account</a> and connected to that to send e-mails to my primary address from the Check For Broken Links app form.  As it turns out, doing so with <code>"net/smtp"</code> is fairly straightforward.  You call <code>smtp.PlainAuth</code> with the proper credentials and domain name, and it returns you back an instance of <code>smtp.Auth</code> that you can use to send e-mails.  I use a custom-defined <code>struct</code> called <code>EmailUser</code> to define the parameters for that call for clarity's sake, and so that I can keep them defined in a configuration file.</p>

<p>This is an example usage:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><pre><code>type EmailUser struct {
    Username    string
    Password    string
    EmailServer string
    Port        int
}

emailUser := &amp;EmailUser{'yourGmailUsername', 'password', 'smtp.gmail.com', 587}

auth := smtp.PlainAuth(&quot;&quot;,
    emailUser.Username,
    emailUser.Password,
    emailUser.EmailServer
)</code></pre></figure></notextile></div>


<h1>Templating Mail</h1>

<p>Odds are good that you don't want to send identical e-mails all of the time, so I'll walk you through setting up some basic templated e-mails and then show you how to send them using <code>net/smtp</code> after we've already connected to Gmail.  When you format an e-mail sent with SMTP correctly, useful information about the sender, subject, and so on will be parsed out of the e-mail's body and interpreted/displayed by the recipients e-mail client in the manner that one would expect.  You can also use more complex template structures to generate e-mails that have more user-specific data, for example if you wanted to send your customers a customized report of their server's bandwidth usage over time via e-mail, or a list of the items they purchased and their invoicing status.</p>

<p>I use a struct called <code>SmtpTemplateData</code> to keep track of the basic information for templating the e-mail.  In this case, we know the value of the e-mail body text ahead of time, but we could also run a template for the body template if we wanted to include business-specific logic such as mentioned above.  We import <code>"text/template"</code> and <code>"bytes"</code>, then:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><pre><code>type SmtpTemplateData struct {
    From    string
    To      string
    Subject string
    Body    string
}

const emailTemplate = `From: &amp;#123;&amp;#123;.From&amp;#125;&amp;#125;
To: &amp;#123;&amp;#123;.To&amp;#125;&amp;#125;
Subject: &amp;#123;&amp;#123;.Subject&amp;#125;&amp;#125;

&amp;#123;&amp;#123;.Body&amp;#125;&amp;#125;

Sincerely,

&amp;#123;&amp;#123;.From&amp;#125;&amp;#125;
`
var err error
var doc bytes.Buffer

context := &amp;SmtpTemplateData{
    &quot;SmtpEmailSender&quot;,
    &quot;recipient@domain.com&quot;,
    &quot;This is the e-mail subject line!&quot;,
    &quot;Hello, this is a test e-mail body.&quot;
}
t := template.New(&quot;emailTemplate&quot;)
t, err = t.Parse(emailTemplate)
if err != nil {
    log.Print(&quot;error trying to parse mail template&quot;)
}
err = t.Execute(&amp;doc, context)
if err != nil {
    log.Print(&quot;error trying to execute mail template&quot;)
}</code></pre></figure></notextile></div>


<p>Then, you can send mail with <code>smtp.SendMail</code>, passing a list of recipients as well as the <code>bytes.Buffer</code> buffer for the body of the e-mail:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><pre><code>err = smtp.SendMail(emailUser.EmailServer+&quot;:&quot;+strconv.Itoa(emailUser.Port), // in our case, &quot;smtp.google.com:587&quot;
    auth,
    emailUser.Username,
    []string{&quot;nathanleclaire@gmail.com&quot;},
    doc.Bytes())
if err != nil {
    log.Print(&quot;ERROR: attempting to send a mail &quot;, err)
}</code></pre></figure></notextile></div>


<p>If you want to send e-mails concurrently, or just not block in a HTTP handler, you can encapsulate the above functionality in a function and invoke it with <code>go sendMail(/* params ... */)</code>.</p>

<h1>Conclusion</h1>

<p><code>"net/smtp"</code> gets the job done, but specifically for the task of sending e-mails from Gmail it takes a little bit of setup.  I may take a whack at making a simple, clean implementation of a library for this purpose (also providing support for boilerplate templating).</p>

<p>Hope this article has been useful and you have a Merry Christmas.  And as always, stay sassy Internet.</p>

<ul>
<li>Nathan</li>
</ul>


    </div>
    <footer>
        <p>If you find a mistake or issue in this article, please <a id="pull-request-link" taget="_blank" href="">fix it and submit a pull request on Github</a> (must be signed in to your GitHub account).</p>
        <a target="_blank" style="display: block;" href="https://twitter.com/share?url=http://nathanleclaire.com/blog/2013/12/17/sending-email-from-gmail-using-golang/&text=Great article from @upthecyberpunks : " class="social-media-spam">Tweet It</a>
        <a target="_blank" href="https://news.ycombinator.com/submitlink?u=http://nathanleclaire.com/blog/2013/12/17/sending-email-from-gmail-using-golang/&t=" class="social-media-spam">Submit to Hacker News</a>
        <a target="_blank" style="display: block !important;" href="http://www.reddit.com/submit?url=http://nathanleclaire.com/blog/2013/12/17/sending-email-from-gmail-using-golang/&title=" class="social-media-spam">Submit to Reddit</a>
        <br>


		



  
		
			Tagged under
		
    <a class='category' href='/blog/categories/email/'>email</a>, <a class='category' href='/blog/categories/golang/'>golang</a>, <a class='category' href='/blog/categories/smtp/'>smtp</a>
	

 

        <a target="_blank" style="display: block !important;" href="http://discourse.nathanleclaire.com">Chat in the forum!!</a>
    
        <div id="discourse-comments"></div>
    </footer>
    
</article>
<!-- END OF _includes/article.html -->


<!-- END OF _/layouts/post.html -->

			</div>
			<form class="modal" id="mailing-list-modal" action="http://nathanleclaire.us3.list-manage.com/subscribe/post?u=bb81abde21debade7a3b6c8f8&amp;id=a77a90269c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<h1>Like what you're reading?</h1>
					<img src="/images/happy-reader.jpeg"></img>
					<p style="display: block;" for="mce-EMAIL">Did you enjoy this article?  You might want to sign up for my mailing list.  I send out weekly-ish essays about hot new tech stuff.</p>
					<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL-modal" placeholder="email@domain.com" required>
					<input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="button">
					<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
				    <div style="position: absolute; left: -5000px;"><input type="text" name="b_bb81abde21debade7a3b6c8f8_a77a90269c" value=""></div>
			</form>
		</div> <!-- // .wrap -->
	<script type="text/javascript" src="/js/prettify.js"></script>
	<script>
	function supports_html5_storage() {
	  try {
		return 'localStorage' in window && window['localStorage'] !== null;
	  } catch (e) {
		return false;
	  }
	}

	$(document).ready(function () {
	    var fuse;

	    $("code").addClass("prettyprint");
	    prettyPrint();

	    $.getJSON("/articles.json", function(data) {
	    	// input:
	    	// [{title: "Learn Node.js The Troll Way", href: "blahblah"}, { ... }]
	    	fuse = new Fuse(data, {
	    	    keys: ['title', 'tags']
	    	});
	    });
	    
	    $("#archive-search").keyup(function() {
	    	var $this = $(this);
	    	var val = $this.val();
	    	var result = fuse.search(val).slice(0, 1);
	    	$list = $("#archive-search-populate");
	    	$list.empty();
	    	if (result.length > 0 && val !== '') {
	    	    $.each(result, function(i, e) {
	    	        $list.append('<li><a href="'+ e.href +'">'+ e.title +'</a></li>');
	    	    });
	    	}
	    });
	    
	    $(".social-media-spam").each(function () {
	        var e = $(this);
	        var t = e.attr("href");
	        var n = $("article header h1 a").html();
	        t += encodeURIComponent(n);
	        e.attr("href", t)
	    });

	    var e = window.location.href;
	    var t = $("#pull-request-link");
	    var n = "https://github.com/nathanleclaire/blog/edit/master/source/_posts/" + e.split("/").slice(4, 8).join("-") + ".markdown";
	    t.attr("href", n);

	    // Only offer mailing list once
		var tryModal = localStorage["modal"] ? false : true;

		// Don't offer mailing list to people on mobile
		if ($(window).width() < 720) {
			tryModal = false;
		}

		$('#mc-embedded-subscribe').click(function() {
			// Don't offer mailing list if people have
			// already clicked to try and sign up
			tryModal = false;
			localStorage["modal"] = "true";
		});

		$(window).scroll(function () {
			if (tryModal && document.URL.indexOf('archives') === -1 && document.URL.indexOf('about') === -1) {
				if (($(window).scrollTop() + $(window).height()) === $(document).height()) {
					if (supports_html5_storage()) {
						window.setTimeout(function() {
							$('#mailing-list-modal').modal({
								fadeDuration: 250
							});
							$('#mce-EMAIL-modal').focus();
							tryModal = false;
							localStorage["modal"] = "true";
						}, 1000);
					}
				}
			}
		});


	});
	</script>
	<script type="text/javascript">
	if ('/blog/2013/12/17/sending-email-from-gmail-using-golang/' !== '/blog/index.html') {
	  var discourseUrl = "http://discourse.nathanleclaire.com/",
	      discourseEmbedUrl = 'http://nathanleclaire.com/blog/2013/12/17/sending-email-from-gmail-using-golang/';

	  (function() {
	    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
	      d.src = discourseUrl + 'javascripts/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
	  })();
	}
	</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	  ga('create', 'UA-26758702-2', 'nathanleclaire.com');
	  ga('send', 'pageview');
	</script>
	</body>
</html>
<!-- END OF _layouts/default.html -->
